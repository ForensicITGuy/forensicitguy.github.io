<!DOCTYPE html>
<html lang="en">




<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    Adding Process Hiding to Merlin
     | Tony Lambert 
  </title>
  <link rel="stylesheet" href='https://forensicitguy.github.io/css/site.min.79fe936623aa76027ec7f37e2c1f88575bc07ec92581712940e3dd619a002236e0522d1202b5d1f6df0ddca3a2aea9a163ce58001d960ed138f4f19e83fa83db.css' integrity='sha512-ef6TZiOqdgJ&#43;x/N&#43;LB&#43;IV1vAfsklgXEpQOPdYZoAIjbgUi0SArXR9t8N3KOirqmhY85YAB2WDtE49PGeg/qD2w=='>
  <link rel="canonical" href="https://forensicitguy.github.io/posts/adding-process-hiding-to-merlin/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://forensicitguy.github.io/index.xml" title="Where DFIR Meets IT">
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Tony Lambert">
<meta name="description" content="Sometimes red team tools need a little bit of extra love to address certain platforms. As I researched Merlin for detection strategies on the blue team side, I noticed that it could use some extra functionality to help replicate what we see in the real world for Linux compromises.
One particular technique that fascinated me was the combination of LD_PRELOAD with libprocesshider to gain a little bit of rootkit functionality and hide processes from casual observers.">

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/forensicitguy.github.io"
        },
        "articleSection" : "posts",
        "name" : "Adding Process Hiding to Merlin",
        "headline" : "Adding Process Hiding to Merlin",
        "description" : "Sometimes red team tools need a little bit of extra love to address certain platforms. As I researched Merlin for detection strategies on the blue team side, I noticed that it could use some extra functionality to help replicate what we see in the real world for Linux compromises.\nOne particular technique that fascinated me was the combination of LD_PRELOAD with libprocesshider to gain a little bit of rootkit functionality and hide processes from casual observers.",
        "inLanguage" : "en-US",
        "author" : "Tony Lambert",
        "creator" : "Tony Lambert",
        "publisher": "Tony Lambert",
        "accountablePerson" : "Tony Lambert",
        "copyrightHolder" : "Tony Lambert",
        "copyrightYear" : "2019",
        "datePublished": "2019-08-28 00:00:00 \x2b0000 UTC",
        "dateModified" : "2019-08-28 00:00:00 \x2b0000 UTC",
        "url" : "https:\/\/forensicitguy.github.io\/posts\/adding-process-hiding-to-merlin\/",
        "wordCount" : "203",
        "keywords" : [ "merlin","ld_preload","RedTeam","Blog" ]
    }
</script>

<meta property="og:title" content="Adding Process Hiding to Merlin" />
<meta property="og:description" content="Sometimes red team tools need a little bit of extra love to address certain platforms. As I researched Merlin for detection strategies on the blue team side, I noticed that it could use some extra functionality to help replicate what we see in the real world for Linux compromises.
One particular technique that fascinated me was the combination of LD_PRELOAD with libprocesshider to gain a little bit of rootkit functionality and hide processes from casual observers." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forensicitguy.github.io/posts/adding-process-hiding-to-merlin/" />
<meta property="article:published_time" content="2019-08-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-28T00:00:00+00:00" />

</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://forensicitguy.github.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="https://www.gravatar.com/avatar/c0ec92ffadd1bc3cba3cf9364ea250d6?s=128&d=identicon">
      </figure>
    </a>
    <a class="navbar-item" href="https://forensicitguy.github.io/">
      Where DFIR Meets IT
    </a>
  </div>
  
  <div class="navbar-menu">
    <div class="navbar-start">
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/activedirectory/">
        
        Active directory
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/administrators/">
        
        Administrators
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/base64/">
        
        Base64
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/bash/">
        
        Bash
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/centos-8/">
        
        Cent o s 8
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/certification/">
        
        Certification
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/chrome/">
        
        Chrome
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/dfir/">
        
        DFIR
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/dnf/">
        
        DNF
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/domaincontrollers/">
        
        Domain controllers
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/edr/">
        
        Edr
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/education/">
        
        Education
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/evasion/">
        
        Evasion
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/input/">
        
        Input
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/jar/">
        
        Jar
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/ld_audit/">
        
        Ld audit
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/ld_preload/">
        
        Ld preload
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/libpreloadvaccine/">
        
        Libpreloadvaccine
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/linux/">
        
        Linux
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/localaccounts/">
        
        Local accounts
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/merlin/">
        
        Merlin
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/metasploit/">
        
        Metasploit
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/meterpreter/">
        
        Meterpreter
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/msfvenom/">
        
        Msfvenom
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/netwars/">
        
        Net wars
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/output/">
        
        Output
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/package-manager/">
        
        Package manager
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/penetration-testing/">
        
        Penetration testing
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/persistence/">
        
        Persistence
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/piping/">
        
        Piping
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/plugin/">
        
        Plugin
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/python/">
        
        Python
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/red-hat-enterprise-linux-8/">
        
        Red hat enterprise linux 8
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/red-team/">
        
        Red team
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/redhat/">
        
        Red hat
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/redirection/">
        
        Redirection
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/redteam/">
        
        Red team
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/rhcsa/">
        
        RHCSA
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/sans/">
        
        SANS
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/unix/">
        
        Unix
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/whitelisting/">
        
        Whitelisting
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/windows/">
        
        Windows
        
      </a>
      
      <a class="navbar-item" href="https://forensicitguy.github.io/tags/yum/">
        
        Yum
        
      </a>
      
    </div>
    
    <div class="navbar-end">
      
      <a class="navbar-item" href="https://github.com/ForensicITGuy" rel="noopener" target="_blank">
        <span class="icon">
          
            <img alt="icons/svg/github.svg" src='https://forensicitguy.github.io/icons/svg/github.svg'>
          
        </span>
      </a>
      
      <a class="navbar-item" href="https://linkedin.com/in/tonymlambert" rel="noopener" target="_blank">
        <span class="icon">
          
            <img alt="icons/svg/linkedin.svg" src='https://forensicitguy.github.io/icons/svg/linkedin.svg'>
          
        </span>
      </a>
      
      <a class="navbar-item" href="https://twitter.com/ForensicITGuy" rel="noopener" target="_blank">
        <span class="icon">
          
            <img alt="icons/svg/twitter.svg" src='https://forensicitguy.github.io/icons/svg/twitter.svg'>
          
        </span>
      </a>
      
      <a class="navbar-item" href="mailto:tmlambert13@gmail.com" target="_blank">
        <span class="icon">
          <img alt="email" src='https://forensicitguy.github.io/icons/svg/email.svg'>
        </span>
      </a>
      <a class="navbar-item" href="https://forensicitguy.github.io/index.xml" target="_blank">
        <span class="icon">
          <img alt="rss" src='https://forensicitguy.github.io/icons/svg/rss.svg'>
        </span>
      </a>
      
    </div>
  </div>
</nav>
<section class="hero is-small is-info is-fullwidth">
  <div class="hero-body">
<div class="container">
  <h1 class="title">
    Adding Process Hiding to Merlin
  </h1>
  <h2 class="subtitle">
    <time datetime='2019-08-28T00:00:00Z'>
      August 28, 2019
    </time>
    
    <br>
    
    
    
    <a class="tag is-link" href="https://forensicitguy.github.io/tags/merlin/">merlin</a>
    
    
    
    
    <a class="tag is-link" href="https://forensicitguy.github.io/tags/ld_preload/">ld_preload</a>
    
    
    
    
    <a class="tag is-link" href="https://forensicitguy.github.io/tags/redteam/">RedTeam</a>
    
    
    
  </h2>
</div>

  </div>
</section>
<section class="section">
  <div class="container">
<div class="content is-medium">
  <p>Sometimes red team tools need a little bit of extra love to address certain platforms. As I researched Merlin for detection strategies on the blue team side, I noticed that it could use some extra functionality to help replicate what we see in the real world for Linux compromises.</p>
<p>One particular technique that fascinated me was the combination of LD_PRELOAD with libprocesshider to gain a little bit of rootkit functionality and hide processes from casual observers. This technique has been used in the wild by Rocke and Pancha Group during cryptojacking campaigns.</p>
<p>Once I looked through the extensible module functionality in Merlin, I realized we could fairly easily download, compile, and load libprocesshider as a shared object using /etc/ld.so.preload as long as the Merlin agent has root privileges. With the default module options, the module will hide the Merlin agent itself from observation. If you modify the options, you can choose to hide other processes executing on the system.</p>
<h2 id="detection-notes">Detection Notes</h2>
<p>This wouldn’t be complete without some notes for the blue team for detection! There are a easy search/hunt you can use to find this activity- look for the modification of /etc/ld.so.preload. This file isn’t commonly modified outside security or performance monitoring applications.</p>

</div>


  </div>
</section><footer class="footer">
  <div class="content has-text-centered">
    
    
    <p>
      
      
    </p>
    
  </div>
</footer>


<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-155060013-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>
</html>
